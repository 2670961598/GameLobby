<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>是青鑫就下降100层！</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid black;
        }
        .game-container {
            position: relative;
        }
        .game-title {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            white-space: nowrap;
        }
        .level-display {
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            writing-mode: vertical-lr;
            text-orientation: upright;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            min-width: 300px;
        }
        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        .modal-score {
            font-size: 20px;
            margin-bottom: 30px;
            color: #666;
        }
        .modal-button {
            padding: 10px 30px;
            font-size: 18px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .modal-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title">是青鑫就下降100层！</div>
        <div class="level-display">层数: <span id="level">0</span></div>
        <canvas id="gameCanvas" width="400" height="600"></canvas>
    </div>

    <!-- 添加游戏结束弹窗 -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">游戏结束！</div>
            <div class="modal-score">你的得分是：<span id="finalScore">0</span>分</div>
            <button class="modal-button" onclick="closeModal()">重新开始</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const levelDisplay = document.getElementById('level');

        // 游戏常量
        const PLAYER_WIDTH = 60;
        const PLAYER_HEIGHT = 30;
        const PLATFORM_HEIGHT = 10;
        const PLATFORM_WIDTH = 80;
        const SPIKE_HEIGHT = 20;
        const SPIKE_WIDTH = 20;
        const GRAVITY = 0.5;
        const JUMP_FORCE = -10;
        const INITIAL_PLATFORM_SPEED = 2;
        const SPEED_INCREASE = 0.1;
        const PLATFORM_SPACING = 100;
        const INITIAL_PLAYER_SPEED = 5;  // 初始玩家移动速度

        // 游戏状态
        let gameOver = false;
        let level = 0;
        let score = 0;
        let platformSpeed = INITIAL_PLATFORM_SPEED;
        let playerSpeed = INITIAL_PLAYER_SPEED;  // 玩家移动速度
        let lastPlatformY = canvas.height - PLATFORM_SPACING;

        // 玩家对象
        const player = {
            x: canvas.width / 2 - PLAYER_WIDTH / 2,
            y: canvas.height - 130,
            width: PLAYER_WIDTH,
            height: PLAYER_HEIGHT,
            velocityY: 0,
            isJumping: false
        };

        // 平台数组
        let platforms = [];
        // 尖刺数组
        let spikes = [];

        // 初始化平台
        function initPlatforms() {
            platforms = [];
            platforms.push({
                x: canvas.width / 2 - PLATFORM_WIDTH / 2,
                y: canvas.height - 100,
                width: PLATFORM_WIDTH,
                height: PLATFORM_HEIGHT
            });
            
            for (let i = 1; i < 8; i++) {
                platforms.push({
                    x: Math.random() * (canvas.width - PLATFORM_WIDTH),
                    y: canvas.height - PLATFORM_SPACING * (i + 1),
                    width: PLATFORM_WIDTH,
                    height: PLATFORM_HEIGHT
                });
            }
        }

        // 初始化尖刺
        function initSpikes() {
            spikes = [];
            const spikeCount = 20;
            const spacing = canvas.width / spikeCount;
            for (let i = 0; i < spikeCount; i++) {
                spikes.push({
                    x: i * spacing,
                    y: 0,
                    width: SPIKE_WIDTH,
                    height: SPIKE_HEIGHT
                });
            }
        }

        // 键盘控制
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // 碰撞检测
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // 更新游戏状态
        function update() {
            if (gameOver) return;

            // 玩家移动
            if (keys['ArrowLeft']) {
                player.x -= playerSpeed;  // 使用动态速度
            }
            if (keys['ArrowRight']) {
                player.x += playerSpeed;  // 使用动态速度
            }

            // 限制玩家在画布内
            player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));

            // 更新平台位置
            platforms.forEach(platform => {
                platform.y -= platformSpeed;
            });

            // 移除超出屏幕的平台并添加新平台
            platforms = platforms.filter(platform => platform.y > -PLATFORM_HEIGHT);
            while (platforms.length < 8) {
                platforms.push({
                    x: Math.random() * (canvas.width - PLATFORM_WIDTH),
                    y: lastPlatformY + PLATFORM_SPACING,
                    width: PLATFORM_WIDTH,
                    height: PLATFORM_HEIGHT
                });
                lastPlatformY = platforms[platforms.length - 1].y;
            }

            // 检查玩家是否站在平台上
            let onPlatform = false;
            platforms.forEach(platform => {
                if (player.velocityY >= 0 &&
                    player.y + player.height <= platform.y + 10 &&
                    player.y + player.height >= platform.y - 10 &&
                    player.x + player.width > platform.x &&
                    player.x < platform.x + platform.width) {
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    onPlatform = true;
                    
                    // 检查是否是新平台
                    if (!platform.visited) {
                        platform.visited = true;
                        score++;
                        level = score;
                        levelDisplay.textContent = level;
                        platformSpeed += SPEED_INCREASE;
                        playerSpeed += SPEED_INCREASE * 0.5;  // 玩家速度也相应增加，但增加幅度较小
                    }
                }
            });

            // 应用重力
            if (!onPlatform) {
                player.velocityY += GRAVITY;
            }
            player.y += player.velocityY;

            // 检查是否掉出屏幕
            if (player.y > canvas.height) {
                gameOver = true;
                showGameOver(`游戏结束！\n你的得分是：${score}分`);
            }

            // 检查是否碰到尖刺
            spikes.forEach(spike => {
                if (checkCollision(player, spike)) {
                    gameOver = true;
                    showGameOver(`游戏结束！\n你的得分是：${score}分`);
                }
            });
        }

        // 绘制游戏
        function draw() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 绘制玩家
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText('叶青鑫', player.x, player.y + player.height - 5);

            // 绘制平台
            platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // 绘制尖刺
            spikes.forEach(spike => {
                ctx.beginPath();
                ctx.moveTo(spike.x + spike.width / 2, spike.y + spike.height);
                ctx.lineTo(spike.x, spike.y);
                ctx.lineTo(spike.x + spike.width, spike.y);
                ctx.closePath();
                ctx.fill();
            });
        }

        // 游戏循环
        function gameLoop() {
            update();
            draw();
            if (!gameOver) {
                requestAnimationFrame(gameLoop);
            }
        }

        // 显示游戏结束
        function showGameOver(message) {
            const modal = document.getElementById('gameOverModal');
            const finalScore = document.getElementById('finalScore');
            finalScore.textContent = score;
            modal.style.display = 'block';
        }

        // 关闭弹窗
        function closeModal() {
            const modal = document.getElementById('gameOverModal');
            modal.style.display = 'none';
            resetGame();
        }

        // 重置游戏
        function resetGame() {
            gameOver = false;
            level = 0;
            score = 0;
            platformSpeed = INITIAL_PLATFORM_SPEED;
            playerSpeed = INITIAL_PLAYER_SPEED;
            lastPlatformY = canvas.height - PLATFORM_SPACING;
            player.x = canvas.width / 2 - PLAYER_WIDTH / 2;
            player.y = canvas.height - 130;
            player.velocityY = 0;
            levelDisplay.textContent = level;
            initPlatforms();
            initSpikes();
            gameLoop();
        }

        // 开始游戏
        initPlatforms();
        initSpikes();
        gameLoop();
    </script>
</body>
</html> 