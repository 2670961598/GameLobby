import{d as M,r as p,k as W,C as B,c as Y,B as N,a as g,j as x,e as b,b as t,h as y,_ as U,t as k,u as L,F as J,q as P,l as Q,z as X,g as Z}from"./index-DHcTEKWX.js";import{u as ee}from"./game-C5QLh6hG.js";import"./api-BwYmMII6.js";const te=s=>({submitScore:(l,c)=>(console.log(`Game ${s} submitted score: ${l} to leaderboard: ${c||"default"}`),{success:!0}),getUser:()=>({id:"user123",name:"Player",isGuest:!0}),getLeaderboard:async l=>(console.log(`Game ${s} requested leaderboard: ${l||"default"}`),[{rank:1,name:"Player1",score:1e3},{rank:2,name:"Player2",score:850},{rank:3,name:"Player3",score:720}]),sendMessage:(l,c)=>(console.log(`Game ${s} sent message: ${l}`,c),{received:!0}),logEvent:(l,c)=>{console.log(`Game ${s} event: ${l}`,c)}}),oe=(s,l)=>{var r;if(!s.contentWindow)throw new Error("Iframe content window not available");const c=te(l);window.addEventListener("message",n=>{var u,f;if(n.source!==s.contentWindow)return;const{cmd:i,args:v=[],callId:d}=n.data||{};if(!(!i||!(i in c)))try{const w=c[i];if(typeof w=="function"){const a=w(...v);d&&((u=s.contentWindow)==null||u.postMessage({type:"platform-api-response",callId:d,result:a},"*"))}}catch(w){console.error(`Error executing API command ${i}:`,w),d&&((f=s.contentWindow)==null||f.postMessage({type:"platform-api-error",callId:d,error:"API execution error"},"*"))}});try{const n=`
      // Platform API Client
      window.PlatformAPI = new Proxy({}, {
        get(target, prop) {
          return (...args) => {
            return new Promise((resolve, reject) => {
              const callId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
              
              // Listen for the response
              const messageHandler = (event) => {
                if (event.data && event.data.callId === callId) {
                  window.removeEventListener('message', messageHandler);
                  
                  if (event.data.type === 'platform-api-error') {
                    reject(new Error(event.data.error));
                  } else {
                    resolve(event.data.result);
                  }
                }
              };
              
              window.addEventListener('message', messageHandler);
              
              // Send the request to the parent
              window.parent.postMessage({
                cmd: prop,
                args: args,
                callId: callId
              }, '*');
              
              // Timeout after 5 seconds
              setTimeout(() => {
                window.removeEventListener('message', messageHandler);
                reject(new Error('API call timed out'));
              }, 5000);
            });
          };
        }
      });
      
      // Notify platform that the game is ready
      window.parent.postMessage({ cmd: 'gameLoaded' }, '*');
      
      console.log('Platform API initialized');
    `,i=s.contentDocument||((r=s.contentWindow)==null?void 0:r.document);if(!i)return;const v=i.createElement("script");v.textContent=n,i.readyState==="complete"||i.readyState==="interactive"?i.body.appendChild(v):s.addEventListener("load",()=>{var u;const d=s.contentDocument||((u=s.contentWindow)==null?void 0:u.document);d&&d.body.appendChild(v)})}catch(n){console.error("Error injecting platform API script:",n)}},ae={key:0,class:"sandbox-overlay loading"},ne={key:1,class:"sandbox-overlay error"},re=["src"],se=M({__name:"GameSandbox",props:{game:{}},setup(s){const l=s,c=N(),r=p(null),n=p(!0),i=p(!1),v=a=>{if(!r.value||a.source!==r.value.contentWindow)return;const{cmd:h,data:m}=a.data;switch(h){case"submitScore":console.log("Game submitted score:",m.score);break;case"gameLoaded":n.value=!1;break}};W(()=>{window.addEventListener("message",v),r.value&&(r.value.addEventListener("load",d),r.value.addEventListener("error",u))}),B(()=>{window.removeEventListener("message",v),r.value&&(r.value.removeEventListener("load",d),r.value.removeEventListener("error",u))});const d=()=>{if(n.value=!1,r.value)try{oe(r.value,l.game.id)}catch(a){console.error("Failed to inject platform API:",a)}},u=()=>{n.value=!1,i.value=!0},f=Y(()=>{const a=new URL(`/game/${l.game.id}/`,window.location.origin);return c.query.room?(console.log("Ê£ÄÊµãÂà∞ÊàøÈó¥ÂèÇÊï∞ÔºåÂä†ÂÖ•ÊåáÂÆöÊàøÈó¥:",c.query.room),a.searchParams.set("room",c.query.room)):console.log("Ê≤°ÊúâÊàøÈó¥ÂèÇÊï∞ÔºåÂ∞ÜÂàõÂª∫Êñ∞ÊàøÈó¥"),c.query.spectator&&(console.log("Ê£ÄÊµãÂà∞ËßÇÊàòÂèÇÊï∞Ôºå‰ª•ËßÇÊàòÊ®°ÂºèËøõÂÖ•:",c.query.spectator),a.searchParams.set("spectator",c.query.spectator)),console.log("Ê∏∏ÊàèURL:",a.toString()),a.toString()}),w=()=>{n.value=!0,i.value=!1,r.value&&(r.value.src=f.value)};return(a,h)=>(y(),g("div",{class:x(["game-sandbox",{"is-loading":n.value}])},[n.value?(y(),g("div",ae,h[0]||(h[0]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Loading game...",-1)]))):b("",!0),i.value?(y(),g("div",ne,[h[1]||(h[1]=t("p",null,"Failed to load the game",-1)),t("button",{onClick:w,class:"retry-button"}," Retry ")])):b("",!0),t("iframe",{ref_key:"iframeRef",ref:r,src:f.value,sandbox:"allow-scripts allow-same-origin allow-pointer-lock",allow:"autoplay; fullscreen",frameborder:"0",scrolling:"no",title:"Game Sandbox"},null,8,re)],2))}}),le=U(se,[["__scopeId","data-v-53008fb1"]]),ce={class:"game-play"},ie={class:"notification-icon"},ue={class:"notification-text"},de={key:1,class:"loading-state"},me={key:2,class:"error-state"},ve={class:"game-header"},fe={key:0,class:"focus-indicator"},pe={key:1,class:"click-hint-overlay"},ge={key:0,class:"game-controls"},ye={class:"control-section"},we=M({__name:"GamePlay",setup(s){const l={capture:!0,passive:!1},c=N(),r=X(),n=ee(),i=c.params.id,v=p(!0),d=p(""),u=p(!1),f=p(""),w=p(!1),a=p(null),h=p(null),m=p(!1);W(async()=>{try{await n.loadGame(i),n.currentGame||(d.value="Game not found")}catch(e){d.value="Failed to load the game",console.error(e)}finally{v.value=!1}document.addEventListener("fullscreenchange",$),document.addEventListener("keydown",I,l),document.addEventListener("keyup",A,l),document.addEventListener("wheel",R,{capture:!0,passive:!1}),document.addEventListener("click",F,{capture:!0})}),B(()=>{document.removeEventListener("fullscreenchange",$),document.removeEventListener("keydown",I,l),document.removeEventListener("keyup",A,l),a.value&&a.value.removeEventListener("wheel",H),document.removeEventListener("click",F,!0),document.removeEventListener("wheel",R,!0),C()});const j=()=>{Z(()=>{var o;const e=(o=a.value)==null?void 0:o.querySelector("iframe");if(e)try{e.focus(),e.contentWindow&&e.contentWindow.focus()}catch{console.debug("Cannot focus iframe due to cross-origin restrictions")}})},V=()=>{document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"},C=()=>{document.documentElement.style.overflow="",document.body.style.overflow=""},G=()=>{m.value||(m.value=!0,V()),a.value&&a.value.focus(),j()},_=()=>{m.value&&(m.value=!1,C())},S=new Set(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","Tab","Escape"]),I=e=>{if(m.value){if(e.code==="F11"){e.preventDefault(),e.stopPropagation(),D();return}if(S.has(e.code)&&(e.preventDefault(),e.stopPropagation()),e.code==="Escape"){_();return}}},A=e=>{m.value&&S.has(e.code)&&(e.preventDefault(),e.stopPropagation())},H=e=>{m.value&&e.preventDefault()},F=e=>{if(!a.value)return;const o=e.target;a.value.contains(o)?G():_()},$=()=>{u.value=!!document.fullscreenElement},D=async()=>{try{if(u.value)document.exitFullscreen&&await document.exitFullscreen();else{const e=document.querySelector(".game-container");e&&e.requestFullscreen&&await e.requestFullscreen()}}catch(e){console.error("Fullscreen error:",e)}},q=()=>{r.back()},O=async()=>{try{const e=window.location.href;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e),E("Ê∏∏ÊàèÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ","success");else{const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy"),E("Ê∏∏ÊàèÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ","success")}catch(T){E("Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•","error"),console.error("Â§çÂà∂Â§±Ë¥•:",T)}finally{document.body.removeChild(o)}}}catch(e){E("Â§çÂà∂Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï"),console.error("ÂàÜ‰∫´Â§±Ë¥•:",e)}},E=(e,o)=>{f.value=e,w.value=!0,setTimeout(()=>{w.value=!1},3e3)},z=()=>{n.currentGame&&r.push(`/leaderboard/${n.currentGame.id}`)},K=()=>{setTimeout(()=>{const e=document.activeElement;a.value&&!a.value.contains(e)&&_()},0)},R=e=>{m.value&&a.value&&a.value.contains(e.target)&&e.preventDefault()};return(e,o)=>(y(),g("div",ce,[w.value?(y(),g("div",{key:0,class:x(["share-notification",{success:f.value.includes("Â∑≤Â§çÂà∂"),error:!f.value.includes("Â∑≤Â§çÂà∂")}])},[t("span",ie,k(f.value.includes("Â∑≤Â§çÂà∂")?"‚úì":"‚ö†"),1),t("span",ue,k(f.value),1)],2)):b("",!0),v.value?(y(),g("div",de,o[0]||(o[0]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Loading game...",-1)]))):d.value?(y(),g("div",me,[t("p",null,k(d.value),1),t("button",{onClick:q,class:"btn-secondary"},"Go Back")])):L(n).currentGame?(y(),g(J,{key:3},[t("div",ve,[t("button",{onClick:q,class:"back-button"},o[1]||(o[1]=[t("span",null,"‚Üê",-1),P(" Back ")])),t("h1",null,k(L(n).currentGame.title),1),t("button",{onClick:D,class:"fullscreen-button"},k(u.value?"Exit Fullscreen":"Fullscreen"),1)]),t("div",{ref_key:"gameContainerRef",ref:a,class:x(["game-container",{"is-fullscreen":u.value,"is-focused":m.value}]),tabindex:"0",onFocus:G,onBlur:K,onClick:G},[Q(le,{ref_key:"gameSandboxRef",ref:h,game:L(n).currentGame},null,8,["game"]),m.value&&!u.value?(y(),g("div",fe,o[2]||(o[2]=[t("span",{class:"focus-text"},"Game Active",-1)]))):b("",!0),!m.value&&!u.value?(y(),g("div",pe,o[3]||(o[3]=[t("div",{class:"click-hint"},[t("span",{class:"hint-icon"},"üéÆ"),t("span",{class:"hint-text"},"Click to activate game controls"),t("small",{class:"hint-subtext"},"Arrow keys and space will be captured")],-1)]))):b("",!0)],34),u.value?b("",!0):(y(),g("div",ge,[t("div",ye,[o[4]||(o[4]=t("h3",null,"Controls",-1)),t("p",null,k(L(n).currentGame.controls||"Use keyboard and mouse to play."),1),o[5]||(o[5]=t("div",{class:"input-tip"},[t("span",{class:"tip-icon"},"üí°"),t("span",null,"Click on the game area to activate keyboard controls. Page scrolling will be prevented only while the game is active.")],-1))]),t("div",{class:"actions-section"},[t("button",{class:"btn-primary",onClick:O},o[6]||(o[6]=[t("span",{class:"btn-icon"},"üîó",-1),P(" Share Game ")])),t("button",{class:"btn-secondary",onClick:z},o[7]||(o[7]=[t("span",{class:"btn-icon"},"üèÜ",-1),P(" View Leaderboard ")]))])]))],64)):b("",!0)]))}}),Ee=U(we,[["__scopeId","data-v-03f442f7"]]);export{Ee as default};
