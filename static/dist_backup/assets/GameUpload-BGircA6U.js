import{d as H,r as d,c as Z,a as n,b as l,m as F,j as z,e as m,t as I,v as w,x as k,z as V,h as u,_ as S}from"./index-DHcTEKWX.js";import{p as C}from"./api-BwYmMII6.js";const N={class:"upload-page"},$={class:"upload-container"},B={class:"mode-selection"},J={class:"upload-form"},j={key:0,class:"upload-section"},A={class:"form-group"},W=["disabled"],O={key:0,class:"file-info"},R={class:"form-group"},K=["disabled"],Q={key:1,class:"upload-section"},X={class:"form-group"},Y=["disabled"],ee={class:"form-group"},le=["disabled"],te={key:0,class:"file-info"},ae={class:"form-group"},ie=["disabled"],se={key:2,class:"upload-section"},oe={class:"form-group"},de=["disabled"],ne={class:"form-group"},ue=["disabled"],re={class:"form-group"},ve=["disabled"],pe={key:0,class:"file-info"},me={class:"form-group"},fe=["disabled"],he={key:3,class:"message error-message"},ge={key:4,class:"message success-message"},ce=["disabled"],be={key:0},we={key:1},ke=H({__name:"GameUpload",setup(ye){const x=V(),s=d("html"),r=d(""),i=d(!1),o=d(""),f=d(""),h=d(null),g=d(null),v=d(""),p=d(""),c=d(""),b=d(null),T=()=>{r.value="",o.value="",f.value="",h.value=null,g.value=null,v.value="",p.value="",c.value="",b.value=null},_=t=>{s.value=t,T()},E=t=>{const e=t.target;if(e.files&&e.files[0]){if(!e.files[0].name.toLowerCase().endsWith(".html")){o.value="请选择HTML文件";return}h.value=e.files[0],o.value=""}},G=t=>{const e=t.target;if(e.files&&e.files[0]){if(!e.files[0].name.toLowerCase().endsWith(".zip")){o.value="请选择ZIP文件";return}g.value=e.files[0],o.value=""}},L=t=>{const e=t.target;if(e.files&&e.files[0]){const a=e.files[0];if(!["image/png","image/jpeg","image/jpg","image/gif"].includes(a.type)){o.value="请选择PNG、JPG或GIF格式的图片";return}b.value=a,o.value=""}},P=t=>t?/^[a-zA-Z0-9]+$/.test(t)?t.length<2?"游戏ID至少需要2个字符":t.length>50?"游戏ID不能超过50个字符":null:"游戏ID只能包含英文字母和数字":"游戏ID不能为空",q=t=>t?!t.startsWith("http://")&&!t.startsWith("https://")?"链接必须以 http:// 或 https:// 开头":null:"游戏链接不能为空",D=Z(()=>s.value==="html"?h.value&&!i.value:s.value==="zip"?g.value&&v.value&&!i.value:s.value==="link"?p.value&&c.value&&b.value&&!i.value:!1),U=async()=>{if(D.value){o.value="",f.value="",i.value=!0;try{const t=new FormData;if(s.value==="html"){if(!h.value)throw new Error("请选择HTML文件");t.append("game_file",h.value),t.append("author",r.value||"匿名");const e=await C("/upload-game",t);if(!e.ok){const a=await e.text();throw new Error(a||"上传失败")}f.value="游戏上传成功！正在跳转到首页...",setTimeout(()=>{x.push("/")},2e3)}else if(s.value==="zip"){if(!g.value||!v.value)throw new Error("请填写完整信息");const e=P(v.value);if(e)throw new Error(e);t.append("zip_file",g.value),t.append("game_id",v.value.toLowerCase()),t.append("author",r.value||"匿名");const a=await C("/upload-zip",t);if(!a.ok){const y=await a.text();throw new Error(y||"上传失败")}f.value="ZIP游戏包上传成功！正在跳转到首页...",setTimeout(()=>{x.push("/")},2e3)}else if(s.value==="link"){if(!p.value||!c.value||!b.value)throw new Error("请填写完整信息");const e=P(p.value);if(e)throw new Error(e);const a=q(c.value);if(a)throw new Error(a);t.append("game_id",p.value.toLowerCase()),t.append("link",c.value),t.append("image_file",b.value),t.append("author",r.value||"匿名");const y=await C("/upload-link",t);if(!y.ok){const M=await y.text();throw new Error(M||"上传失败")}f.value="外部链接游戏注册成功！正在跳转到首页...",setTimeout(()=>{x.push("/")},2e3)}}catch(t){o.value=t instanceof Error?t.message:"上传失败",console.error("Upload error:",t)}finally{i.value=!1}}};return(t,e)=>(u(),n("div",N,[l("div",$,[e[27]||(e[27]=l("h1",null,"上传你的小游戏",-1)),e[28]||(e[28]=l("p",{class:"subtitle"},"分享你的HTML5游戏给社区",-1)),l("div",B,[l("button",{class:z(["mode-btn",{active:s.value==="html"}]),onClick:e[0]||(e[0]=a=>_("html"))}," 📄 单文件HTML ",2),l("button",{class:z(["mode-btn",{active:s.value==="zip"}]),onClick:e[1]||(e[1]=a=>_("zip"))}," 📦 ZIP游戏包 ",2),l("button",{class:z(["mode-btn",{active:s.value==="link"}]),onClick:e[2]||(e[2]=a=>_("link"))}," 🔗 外部链接 ",2)]),l("div",J,[s.value==="html"?(u(),n("div",j,[e[13]||(e[13]=l("h2",null,"上传单文件HTML游戏",-1)),l("div",A,[e[11]||(e[11]=l("label",{for:"html-file"},"选择HTML文件 *",-1)),l("input",{id:"html-file",type:"file",accept:".html",onChange:E,disabled:i.value},null,40,W),h.value?(u(),n("p",O," 选中文件: "+I(h.value.name),1)):m("",!0)]),l("div",R,[e[12]||(e[12]=l("label",{for:"html-author"},"作者名称",-1)),w(l("input",{id:"html-author","onUpdate:modelValue":e[3]||(e[3]=a=>r.value=a),type:"text",placeholder:"请输入作者名称（可选）",maxlength:"32",disabled:i.value},null,8,K),[[k,r.value]])])])):m("",!0),s.value==="zip"?(u(),n("div",Q,[e[18]||(e[18]=l("h2",null,"上传ZIP游戏包",-1)),l("div",X,[e[14]||(e[14]=l("label",{for:"zip-game-id"},"游戏ID *",-1)),w(l("input",{id:"zip-game-id","onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),type:"text",placeholder:"请输入游戏ID（英文数字组合）",pattern:"[A-Za-z0-9]+",maxlength:"50",disabled:i.value,onInput:e[5]||(e[5]=a=>v.value=v.value.toLowerCase())},null,40,Y),[[k,v.value]]),e[15]||(e[15]=l("p",{class:"input-hint"},"只能使用英文字母和数字，将自动转为小写",-1))]),l("div",ee,[e[16]||(e[16]=l("label",{for:"zip-file"},"选择ZIP文件 *",-1)),l("input",{id:"zip-file",type:"file",accept:".zip",onChange:G,disabled:i.value},null,40,le),g.value?(u(),n("p",te," 选中文件: "+I(g.value.name),1)):m("",!0)]),l("div",ae,[e[17]||(e[17]=l("label",{for:"zip-author"},"作者名称",-1)),w(l("input",{id:"zip-author","onUpdate:modelValue":e[6]||(e[6]=a=>r.value=a),type:"text",placeholder:"请输入作者名称（可选）",maxlength:"32",disabled:i.value},null,8,ie),[[k,r.value]])])])):m("",!0),s.value==="link"?(u(),n("div",se,[e[26]||(e[26]=l("h2",null,"注册外部链接游戏",-1)),l("div",oe,[e[19]||(e[19]=l("label",{for:"link-game-id"},"游戏ID *",-1)),w(l("input",{id:"link-game-id","onUpdate:modelValue":e[7]||(e[7]=a=>p.value=a),type:"text",placeholder:"请输入游戏ID（英文数字组合）",pattern:"[A-Za-z0-9]+",maxlength:"50",disabled:i.value,onInput:e[8]||(e[8]=a=>p.value=p.value.toLowerCase())},null,40,de),[[k,p.value]]),e[20]||(e[20]=l("p",{class:"input-hint"},"只能使用英文字母和数字，将自动转为小写",-1))]),l("div",ne,[e[21]||(e[21]=l("label",{for:"link-url"},"游戏链接 *",-1)),w(l("input",{id:"link-url","onUpdate:modelValue":e[9]||(e[9]=a=>c.value=a),type:"url",placeholder:"http://example.com/your-game",disabled:i.value},null,8,ue),[[k,c.value]]),e[22]||(e[22]=l("p",{class:"input-hint"},"必须以 http:// 或 https:// 开头",-1))]),l("div",re,[e[23]||(e[23]=l("label",{for:"link-preview"},"预览图片 *",-1)),l("input",{id:"link-preview",type:"file",accept:"image/png,image/jpeg,image/gif",onChange:L,disabled:i.value},null,40,ve),b.value?(u(),n("p",pe," 选中图片: "+I(b.value.name),1)):m("",!0),e[24]||(e[24]=l("p",{class:"input-hint"},"支持PNG、JPG、GIF格式，推荐尺寸16:9",-1))]),l("div",me,[e[25]||(e[25]=l("label",{for:"link-author"},"作者名称",-1)),w(l("input",{id:"link-author","onUpdate:modelValue":e[10]||(e[10]=a=>r.value=a),type:"text",placeholder:"请输入作者名称（可选）",maxlength:"32",disabled:i.value},null,8,fe),[[k,r.value]])])])):m("",!0),o.value?(u(),n("div",he," ❌ "+I(o.value),1)):m("",!0),f.value?(u(),n("div",ge," ✅ "+I(f.value),1)):m("",!0),l("button",{class:"upload-button",onClick:U,disabled:!D.value},[i.value?(u(),n("span",be,"正在上传...")):(u(),n("span",we,"上传游戏"))],8,ce)]),e[29]||(e[29]=F(`<div class="upload-guidelines" data-v-29e5d577><h2 data-v-29e5d577>📋 上传说明</h2><div class="guidelines-section" data-v-29e5d577><h3 data-v-29e5d577>📄 单文件HTML游戏</h3><ul data-v-29e5d577><li data-v-29e5d577>适用于只有一个HTML文件的简单游戏</li><li data-v-29e5d577>系统会自动为你创建游戏文件夹并将文件命名为index.html</li><li data-v-29e5d577>游戏名称将根据文件名自动生成</li><li data-v-29e5d577>适合纯HTML/CSS/JavaScript编写的小游戏</li></ul></div><div class="guidelines-section" data-v-29e5d577><h3 data-v-29e5d577>📦 ZIP游戏包上传</h3><ul data-v-29e5d577><li data-v-29e5d577>适用于Unity、PixiJS、Phaser等需要额外资源文件的游戏</li><li data-v-29e5d577>压缩包根目录必须包含<code data-v-29e5d577>index.html</code>文件作为入口</li><li data-v-29e5d577>或者只包含一个子文件夹，其内含<code data-v-29e5d577>index.html</code></li><li data-v-29e5d577>可以包含<code data-v-29e5d577>preview.png</code>文件作为游戏预览图</li><li data-v-29e5d577>支持各种资源文件：图片、音频、字体、脚本等</li><li data-v-29e5d577>最大文件大小：200MB</li><li data-v-29e5d577>上传后可通过游戏ID访问：<code data-v-29e5d577>/game/你的游戏ID</code></li></ul></div><div class="guidelines-section" data-v-29e5d577><h3 data-v-29e5d577>🔗 外部链接游戏</h3><ul data-v-29e5d577><li data-v-29e5d577>适用于已部署在其他服务器上的游戏</li><li data-v-29e5d577>系统会为该链接生成一个本地入口</li><li data-v-29e5d577>必须上传一张预览图片（PNG、JPG或GIF格式）</li><li data-v-29e5d577>推荐预览图尺寸为16:9比例，如1920×1080或1280×720</li><li data-v-29e5d577>点击游戏卡片时会自动跳转到你提供的外部链接</li></ul></div><div class="guidelines-section" data-v-29e5d577><h3 data-v-29e5d577>🎮 通用要求</h3><ul data-v-29e5d577><li data-v-29e5d577>游戏必须能在现代浏览器中正常运行</li><li data-v-29e5d577>内容必须适合所有年龄段，无不当内容</li><li data-v-29e5d577>游戏ID一旦确定无法修改，请谨慎选择</li><li data-v-29e5d577>相同IP地址的用户可以覆盖自己上传的游戏</li><li data-v-29e5d577>游戏成功上传后会出现在首页游戏列表中</li></ul></div><div class="guidelines-section" data-v-29e5d577><h3 data-v-29e5d577>🏆 排行榜接口（可选）</h3><div class="api-info" data-v-29e5d577><p data-v-29e5d577>如果你的游戏需要排行榜功能，可以使用以下API：</p><pre data-v-29e5d577><code data-v-29e5d577>// 提交成绩
POST /scores
Body: {
  &quot;game&quot;: &quot;你的游戏ID&quot;,
  &quot;difficulty&quot;: &quot;easy|medium|hard&quot;,
  &quot;name&quot;: &quot;玩家名&quot;,
  &quot;score&quot;: 1234
}

// 获取排行榜
GET /scores?game=你的游戏ID&amp;difficulty=medium</code></pre><p class="api-note" data-v-29e5d577>difficulty参数可选，默认为medium。服务器会自动保存每位玩家的历史最高分。</p></div></div></div>`,1))])]))}}),_e=S(ke,[["__scopeId","data-v-29e5d577"]]);export{_e as default};
