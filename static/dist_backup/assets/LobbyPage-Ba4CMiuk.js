import{d as N,r,c as U,k as D,o as G,a as o,b as t,e as C,q as x,v,x as w,y as P,F as g,f as b,A as M,z as T,h as a,t as i,j as R,_ as B}from"./index-DHcTEKWX.js";const z={class:"lobby-page"},F={class:"container"},A={class:"lobby-header"},E={class:"header-actions"},J={class:"lobby-controls"},Q={class:"search-bar"},S={class:"game-filter"},H=["value"],K={class:"room-list"},O={key:0,class:"loading"},W={key:1,class:"empty-state"},X={key:2,class:"rooms-grid"},Y={class:"room-header"},Z={class:"room-name"},ss={class:"room-info"},es={class:"game-info"},ts={class:"game-name"},ls={class:"player-info"},os={class:"player-count"},as={class:"host-info"},ns={class:"room-actions"},is=["onClick"],rs={key:1,class:"room-full-actions"},us=["onClick"],ds={class:"form-group"},cs=["value"],vs={class:"form-group"},ps={class:"dialog-actions"},ms=N({__name:"LobbyPage",setup(ys){const _=T(),k=r([]),p=r([]),h=r(!0),c=r(""),n=r(""),u=r(""),d=r(!1),m=U(()=>{let l=k.value;if(n.value&&(l=l.filter(s=>s.game===n.value)),c.value){const s=c.value.toLowerCase();l=l.filter(e=>e.room.toLowerCase().includes(s)||(e.gameName||e.game).toLowerCase().includes(s))}return l}),y=async()=>{try{const s=await(await fetch("/api/rooms")).json();k.value=s.rooms||[]}catch(l){console.error("è·å–æˆ¿é—´åˆ—è¡¨å¤±è´¥:",l)}},q=async()=>{try{const s=await(await fetch("/api/games")).json();p.value=s.games.map(e=>({id:e.id,title:e.title}))}catch(l){console.error("è·å–æ¸¸æˆåˆ—è¡¨å¤±è´¥:",l)}},f=(l,s=!1)=>{console.log("åŠ å…¥æˆ¿é—´:",l),console.log("æˆ¿é—´å·:",l.room),console.log("æ¸¸æˆID:",l.game),console.log("è§‚æˆ˜æ¨¡å¼:",s);const e={room:l.room};s&&(e.spectator="true"),_.push({name:"GamePlay",params:{id:l.game},query:e})},L=l=>{f(l,!0)},V=()=>{if(!n.value||!u.value.trim()){alert("è¯·é€‰æ‹©æ¸¸æˆå¹¶è¾“å…¥æˆ¿é—´å·");return}_.push({name:"GamePlay",params:{id:n.value},query:{room:u.value.trim()}}),d.value=!1,u.value=""},$=()=>{const l=m.value.filter(s=>s.players<s.maxPlayers);l.length>0?f(l[0]):alert("æš‚æ— å¯åŠ å…¥çš„æˆ¿é—´")},j=()=>{y()};return D(async()=>{await Promise.all([y(),q()]),h.value=!1;const l=setInterval(y,5e3);G(()=>{clearInterval(l)})}),(l,s)=>(a(),o("div",z,[t("div",F,[t("header",A,[s[10]||(s[10]=t("div",{class:"header-content"},[t("h1",null,"ğŸ® è”æœºå¤§å…"),t("p",null,"ä¸å…¶ä»–ç©å®¶è¿æ¥ï¼Œäº«å—å¤šäººæ¸¸æˆä¹è¶£")],-1)),t("div",E,[t("button",{onClick:s[0]||(s[0]=e=>d.value=!0),class:"btn-primary"},s[8]||(s[8]=[t("span",{class:"btn-icon"},"â•",-1),x(" åˆ›å»ºæˆ¿é—´ ")])),t("button",{onClick:$,class:"btn-secondary"},s[9]||(s[9]=[t("span",{class:"btn-icon"},"ğŸš€",-1),x(" å¿«é€ŸåŠ å…¥ ")]))])]),t("div",J,[t("div",Q,[v(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>c.value=e),type:"text",placeholder:"æœç´¢æˆ¿é—´å·æˆ–æ¸¸æˆå...",class:"search-input"},null,512),[[w,c.value]]),t("button",{onClick:j,class:"refresh-btn",title:"åˆ·æ–°"}," ğŸ”„ ")]),t("div",S,[v(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>n.value=e),class:"game-select"},[s[11]||(s[11]=t("option",{value:""},"æ‰€æœ‰æ¸¸æˆ",-1)),(a(!0),o(g,null,b(p.value,e=>(a(),o("option",{key:e.id,value:e.id},i(e.title),9,H))),128))],512),[[P,n.value]])])]),t("div",K,[h.value?(a(),o("div",O,s[12]||(s[12]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"åŠ è½½ä¸­...",-1)]))):m.value.length===0?(a(),o("div",W,s[13]||(s[13]=[t("div",{class:"empty-icon"},"ğŸ ",-1),t("h3",null,"æš‚æ— æˆ¿é—´",-1),t("p",null,"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æˆ¿é—´ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´å¼€å§‹æ¸¸æˆå§ï¼",-1)]))):(a(),o("div",X,[(a(!0),o(g,null,b(m.value,e=>(a(),o("div",{key:`${e.game}-${e.room}`,class:R(["room-card",{"room-full":e.players>=e.maxPlayers}])},[t("div",Y,[t("h3",Z,i(e.room),1),t("span",{class:R(["room-status",e.players>=e.maxPlayers?"full":"available"])},i(e.players>=e.maxPlayers?"å·²æ»¡":"å¯åŠ å…¥"),3)]),t("div",ss,[t("div",es,[t("span",ts,i(e.gameName||e.game),1)]),t("div",ls,[t("span",os," ğŸ‘¥ "+i(e.players)+"/"+i(e.maxPlayers),1),t("span",as," ğŸ  "+i(e.host_ip),1)])]),t("div",ns,[e.players<e.maxPlayers?(a(),o("button",{key:0,onClick:I=>f(e),class:"join-btn"}," åŠ å…¥æˆ¿é—´ ",8,is)):(a(),o("div",rs,[s[14]||(s[14]=t("span",{class:"room-full-text"},"æˆ¿é—´å·²æ»¡",-1)),e.gameType==="multiplayer"||e.gameType==="coop"?(a(),o("button",{key:0,onClick:I=>L(e),class:"spectate-btn"}," è§‚æˆ˜ ",8,us)):C("",!0)]))])],2))),128))]))])]),d.value?(a(),o("div",{key:0,class:"dialog-overlay",onClick:s[7]||(s[7]=e=>d.value=!1)},[t("div",{class:"dialog",onClick:s[6]||(s[6]=M(()=>{},["stop"]))},[s[18]||(s[18]=t("h3",null,"åˆ›å»ºæ–°æˆ¿é—´",-1)),t("div",ds,[s[16]||(s[16]=t("label",null,"é€‰æ‹©æ¸¸æˆ",-1)),v(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>n.value=e),class:"form-select",required:""},[s[15]||(s[15]=t("option",{value:""},"è¯·é€‰æ‹©æ¸¸æˆ",-1)),(a(!0),o(g,null,b(p.value,e=>(a(),o("option",{key:e.id,value:e.id},i(e.title),9,cs))),128))],512),[[P,n.value]])]),t("div",vs,[s[17]||(s[17]=t("label",null,"æˆ¿é—´å·",-1)),v(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>u.value=e),type:"text",placeholder:"è¾“å…¥æˆ¿é—´å·...",class:"form-input",maxlength:"20",required:""},null,512),[[w,u.value]])]),t("div",ps,[t("button",{onClick:s[5]||(s[5]=e=>d.value=!1),class:"btn-cancel"},"å–æ¶ˆ"),t("button",{onClick:V,class:"btn-confirm"},"åˆ›å»ºæˆ¿é—´")])])])):C("",!0)]))}}),gs=B(ms,[["__scopeId","data-v-1061774f"]]);export{gs as default};
